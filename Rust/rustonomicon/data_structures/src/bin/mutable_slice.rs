use std::mem;

pub struct IterMut<'a, T: 'a>(&'a mut [T]);

impl<'a, T> Iterator for IterMut<'a, T> {
    type Item = &'a mut T;

    fn next(&mut self) -> Option<Self::Item> {
        let slice = mem::take(&mut self.0);

        if slice.is_empty() {
            return None;
        }

        let (l, r) = slice.split_at_mut(1);

        self.0 = r;

        l.get_mut(0)
    }
}

impl<'a, T> DoubleEndedIterator for IterMut<'a, T> {
    fn next_back(&mut self) -> Option<Self::Item> {
        let slice = mem::take(&mut self.0);

        if slice.is_empty() {
            return None;
        }

        let new_len = slice.len() - 1;
        let (l, r) = slice.split_at_mut(new_len);

        self.0 = l;

        r.get_mut(0)
    }
}

fn main() {}
